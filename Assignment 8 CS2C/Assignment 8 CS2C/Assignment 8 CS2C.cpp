#include "FHsort.h"
#include <iostream>
#include <iomanip>
#include <time.h>
using namespace std;

template <typename Comparable>
void quickSortX(FHvector<Comparable> & a, int left, int right, int recLimit)
{
   Comparable pivot;
   int i, j;

   if (left + recLimit <= right)
   {
      pivot = median3(a, left, right);
      for (i = left, j = right - 1;;)
      {
         while (a[++i] < pivot)
            ;
         while (pivot < a[--j])
            ;
         if (i < j)
            mySwapFH(a[i], a[j]);
         else
            break;
      }

      mySwapFH(a[i], a[right - 1]);  // restore pivot

      // recursive calls on smaller sub-groups
      quickSortX(a, left, i - 1, recLimit);
      quickSortX(a, i + 1, right, recLimit);
   }
   else
      // non-recursive escape valve - insertionSort
      insertionSort(a, left, right);
}

template <typename Comparable>
void quickSortX(FHvector<Comparable> & a, int recLimit)
{
   if (recLimit < 2)
      recLimit = 2;
   quickSortX(a, 0, a.size() - 1, recLimit);
}

int main()
{
   clock_t startTime, stopTime;
   srand(time(NULL));

   const int sizes[6] = { 40000, 90000, 130000, 170000, 210000, 250000 };
   FHvector<int> vectors[6][150];

   vectors[0][0] = FHvector<int>(sizes[0]);
   vectors[1][0] = FHvector<int>(sizes[1]);
   vectors[2][0] = FHvector<int>(sizes[2]);
   vectors[3][0] = FHvector<int>(sizes[3]);
   vectors[4][0] = FHvector<int>(sizes[4]);
   vectors[5][0] = FHvector<int>(sizes[5]);

   int recLimits[150];
   double times[6][150];

   for (int i = 0; i < 6; i++)
   {
      for (int z = 0; z < sizes[i]; z++)
         vectors[i][0][z] = rand();
   }

   for (int i = 0; i < 6; i++)
   {
      for (int z = 1; z < 150; z++)
         vectors[i][z] = vectors[i][0];
   }

   for (int i = 0; i < 150; i++)
   {
      recLimits[i] = 2 * i + 2;
   }

   for (int i = 0; i < 6; i++)
   {
      for (int z = 0; z < 150; z++)
      {
         startTime = clock();
         quickSortX(vectors[i][z], recLimits[z]);
         stopTime = clock();
         times[i][z] = (double)(stopTime - startTime) / (double)CLOCKS_PER_SEC;
      }
   }

   const int width = 10;
   cout << "TABLE (array size by recursion limit)" << endl << endl;
   cout << setw(width) << " " << setw(width) << sizes[0] 
      << setw(width) << sizes[1] << setw(width) << sizes[2] 
      << setw(width) << sizes[3] << setw(width) << sizes[4] 
      << setw(width) << sizes[5] << endl << endl;

   for (int i = 0; i < 150; i++)
   {
      cout << setw(width) << recLimits[i];
      for (int z = 0; z < 6; z++)
      {
         cout << setw(width) << times[z][i];
      }
      cout << endl << endl;
   }

}

//RUNS AND ANSWERS--------------------------------------------------------------
/*
TABLE (array size by recursion limit)

               40000     90000    130000    170000    210000    250000

         2     0.038     0.089     0.133     0.175     0.233     0.265

         4     0.035     0.085     0.126     0.161     0.226      0.25

         6     0.036     0.084     0.124     0.172     0.211      0.25

         8     0.035     0.081     0.123     0.156     0.208      0.25

        10     0.035     0.084     0.123     0.156     0.207     0.252

        12     0.036     0.084     0.124     0.172     0.208     0.234

        14     0.036     0.085     0.124     0.156     0.209     0.259

        16     0.037     0.086     0.127     0.172     0.212      0.25

        18     0.037     0.087     0.128     0.172     0.214     0.255

        20     0.038     0.089     0.131     0.172     0.208     0.251

        22     0.039      0.09     0.132     0.172     0.217     0.261

        24      0.04     0.092     0.136     0.181     0.242      0.25

        26      0.04     0.094     0.138     0.171     0.224     0.266

        28     0.041     0.095      0.14     0.187     0.233     0.281

        30     0.042     0.098     0.142      0.18     0.238     0.265

        32     0.043     0.099     0.146     0.204     0.238     0.282

        34     0.044     0.101     0.148     0.187     0.258     0.293

        36     0.045     0.103     0.151     0.195     0.267     0.281

        38     0.046     0.106     0.154     0.222     0.261     0.297

        40     0.047     0.107     0.158     0.205     0.266     0.298

        42     0.047     0.109      0.16     0.212     0.262     0.313

        44     0.049     0.112     0.163     0.218     0.266     0.306

        46     0.049     0.113     0.166     0.205     0.273     0.332

        48      0.05     0.115     0.169     0.235      0.31     0.317

        50     0.051     0.118     0.172     0.227     0.279     0.328

        52     0.052      0.12     0.174     0.225       0.3     0.328

        54     0.052     0.122     0.178     0.246     0.291     0.345

        56     0.054     0.124     0.181     0.239     0.302     0.344

        58     0.054     0.127     0.183      0.24     0.303     0.362

        60     0.055     0.129     0.187     0.246     0.309     0.358

        62     0.057     0.132     0.191     0.253     0.321     0.359

        64     0.057     0.134     0.192     0.263     0.317     0.382

        66     0.058     0.136     0.196     0.262      0.32     0.375

        68     0.059     0.139     0.199     0.267     0.329     0.375

        70     0.061     0.141     0.202     0.273     0.326     0.393

        72     0.065     0.143     0.206     0.302     0.339     0.391

        74     0.063     0.145     0.208     0.302     0.345     0.408

        76     0.064     0.147     0.212      0.32     0.347      0.39

        78     0.068      0.15     0.216       0.3     0.339     0.422

        80     0.068     0.151     0.219     0.309     0.358      0.42

        82     0.074     0.154     0.223     0.305     0.401     0.423

        84     0.074     0.156     0.227     0.305     0.399     0.423

        86     0.073     0.159     0.229     0.308     0.405     0.437

        88     0.072     0.161     0.233     0.315     0.405     0.453

        90     0.072     0.163     0.236      0.32     0.376     0.439

        92     0.073     0.166      0.24     0.324     0.392     0.469

        94     0.074     0.168     0.242     0.326      0.39     0.454

        96     0.076      0.17     0.246     0.328     0.393     0.469

        98     0.076     0.174      0.25     0.334       0.4     0.485

       100     0.077     0.177     0.252     0.344     0.411     0.474

       102     0.078     0.179     0.255     0.347     0.424     0.487

       104     0.079     0.182     0.259      0.35     0.419     0.501

       106      0.08     0.183     0.263     0.352     0.443       0.5

       108      0.08     0.185     0.267      0.36     0.453       0.5

       110     0.082     0.187     0.271     0.365     0.429     0.515

       112     0.082      0.19     0.274     0.368     0.438     0.516

       114     0.083     0.193     0.278     0.372     0.454     0.532

       116     0.084     0.194      0.28     0.378     0.456     0.532

       118     0.085     0.197     0.283     0.385     0.453     0.532

       120     0.087     0.197     0.285     0.388     0.461     0.554

       122     0.087     0.201     0.291     0.392     0.485     0.557

       124     0.088     0.203     0.293     0.396      0.48     0.554

       126     0.089     0.205     0.297     0.399      0.52     0.571

       128     0.089     0.207     0.302     0.406     0.534      0.58

       130      0.09     0.209     0.304     0.406     0.513     0.567

       132     0.092     0.211     0.308     0.413     0.498     0.594

       134     0.114     0.213     0.311     0.409     0.487     0.589

       136     0.098     0.215     0.314     0.431     0.517     0.604

       138     0.105     0.217     0.317     0.425     0.506      0.59

       140     0.108     0.219      0.32     0.431     0.523     0.609

       142     0.099     0.222     0.323     0.435     0.515     0.625

       144       0.1     0.224     0.325     0.439     0.523     0.625

       146     0.105     0.228     0.328     0.446     0.531     0.633

       148     0.108      0.23     0.332     0.448     0.547     0.643

       150      0.12     0.234     0.336     0.452     0.547      0.64

       152     0.104     0.236     0.344     0.459     0.548     0.639

       154     0.106     0.239     0.348     0.463     0.562     0.657

       156     0.105      0.24     0.359     0.462     0.561     0.672

       158     0.105     0.243     0.359     0.471     0.562     0.673

       160     0.106     0.246     0.356     0.471     0.578     0.688

       162     0.107     0.247     0.362     0.467      0.57     0.688

       164     0.108     0.248     0.366     0.499     0.595     0.687

       166     0.109     0.252     0.363     0.491     0.588     0.705

       168      0.11     0.252     0.358     0.494     0.585     0.703

       170     0.112     0.256     0.375     0.495     0.597     0.703

       172     0.113     0.257     0.375     0.501     0.611      0.72

       174     0.113     0.259     0.376     0.503     0.609     0.736

       176     0.115     0.261      0.39     0.512     0.617      0.72

       178     0.117     0.265     0.375     0.505     0.609      0.75

       180      0.12     0.265     0.407     0.528     0.626     0.735

       182     0.119     0.269     0.403     0.527     0.641     0.751

       184     0.121      0.27     0.396     0.532     0.641     0.767

       186     0.122     0.272     0.389     0.538      0.64     0.766

       188     0.123     0.278     0.409     0.541     0.642     0.775

       190     0.124     0.279     0.421     0.544     0.656     0.765

       192     0.126     0.281     0.403     0.551     0.669     0.797

       194     0.127     0.285     0.413     0.555     0.674     0.797

       196     0.128     0.288     0.416     0.557     0.665     0.805

       198     0.128     0.289     0.448     0.562     0.675     0.814

       200     0.131     0.291     0.425     0.563     0.697     0.814

       202     0.132     0.293     0.431     0.572     0.676     0.828

       204     0.134     0.298     0.434     0.574     0.701     0.829

       206     0.135     0.299      0.45     0.576     0.703     0.845

       208     0.135     0.301     0.441     0.583     0.703     0.838

       210     0.137     0.302     0.446     0.585      0.72     0.844

       212     0.138     0.306     0.427     0.591     0.719     0.859

       214     0.139     0.306      0.44     0.594     0.734     0.858

       216      0.14     0.308     0.453     0.601     0.731     0.872

       218      0.14     0.311     0.435     0.601      0.74     0.876

       220      0.14     0.312     0.464      0.61     0.733     0.895

       222     0.142     0.316     0.469     0.613      0.75     0.882

       224     0.142     0.318     0.461     0.617      0.75     0.926

       226     0.144     0.319     0.473     0.618     0.753     0.949

       228     0.144     0.325     0.472     0.634     0.766     0.907

       230     0.144     0.329      0.47     0.617     0.773     0.914

       232     0.147      0.33     0.472     0.648     0.773      0.92

       234     0.147     0.331     0.471      0.64     0.767     0.929

       236     0.148     0.334     0.471     0.646     0.781     0.934

       238     0.149     0.338     0.491     0.649     0.797     0.941

       240      0.15      0.34     0.494      0.65     0.798     0.948

       242     0.151     0.344     0.484     0.656     0.803     0.958

       244     0.153     0.346       0.5      0.66     0.799     0.963

       246     0.155     0.348       0.5     0.667     0.802     0.968

       248     0.157      0.35       0.5     0.674     0.815     0.973

       250     0.157     0.352     0.502     0.678      0.83      0.98

       252     0.159     0.356     0.515     0.679     0.823     0.988

       254     0.159     0.359     0.501      0.68     0.844     0.993

       256     0.161     0.361      0.51     0.671     0.833     1.001

       258     0.161     0.364     0.522     0.701     0.848     1.005

       260     0.162     0.365     0.522     0.692     0.858     1.028

       262     0.164     0.365     0.533     0.691     0.865     1.024

       264     0.164     0.371     0.529     0.709     0.859     1.034

       266     0.164     0.371     0.522     0.773     0.876     1.053

       268     0.165     0.373     0.536     0.745     0.877     1.074

       270     0.166     0.377     0.551      0.72     0.875     1.054

       272     0.166     0.379     0.531     0.763     0.892     1.069

       274     0.167     0.381     0.578     0.743     0.897     1.061

       276     0.169     0.382     0.616     0.785     0.892     1.065

       278      0.17     0.385     0.559     0.795     0.897     1.074

       280      0.17     0.389     0.563     0.779     0.923     1.078

       282     0.172     0.389     0.573     0.815     0.908     1.081

       284     0.173     0.396     0.553     0.763     0.923     1.088

       286     0.174       0.4     0.578     0.771     0.928     1.095

       288     0.177     0.401     0.563     0.768     0.935     1.104

       290     0.176     0.402      0.58     0.774     0.927     1.115

       292     0.178     0.402     0.584      0.78     0.937     1.118

       294     0.178     0.405     0.585     0.786     0.945     1.124

       296     0.181     0.404     0.602     0.785     0.944     1.131

       298     0.183     0.408     0.598     0.786     0.974     1.139

       300     0.185     0.409     0.595      0.79      0.96     1.147

Press any key to continue . . .

--------------------------------------------------------------------------------

TABLE (array size by recursion limit)

               40000     90000    130000    170000    210000    250000

         2     0.047     0.094      0.14     0.172     0.235     0.266

         4     0.047     0.078     0.125     0.172     0.203     0.265

         6     0.031     0.078     0.125     0.172     0.203      0.25

         8     0.047     0.094     0.135     0.156     0.203     0.236

        10     0.031     0.078     0.124     0.156     0.203      0.25

        12     0.031     0.078     0.125     0.172     0.203     0.258

        14     0.032     0.094     0.127     0.156     0.203      0.25

        16     0.046     0.078     0.118     0.172     0.219     0.243

        18     0.032     0.094     0.125     0.172     0.212     0.258

        20     0.047     0.094     0.141     0.172     0.213     0.264

        22     0.031     0.078     0.125     0.172     0.207      0.26

        24     0.047     0.103      0.14     0.172     0.218     0.267

        26     0.031     0.094     0.141     0.172     0.219     0.268

        28     0.047     0.095      0.14     0.187     0.235      0.27

        30     0.047     0.098     0.141     0.188     0.234     0.279

        32     0.031     0.099     0.141     0.187     0.234     0.307

        34     0.047     0.099     0.156     0.203     0.235     0.298

        36     0.047     0.094     0.156     0.188      0.25     0.287

        38     0.046     0.109     0.156     0.203      0.25     0.305

        40     0.047     0.109     0.157     0.203      0.25     0.297

        42     0.047      0.11     0.156     0.219      0.25     0.316

        44     0.047     0.109     0.172     0.212     0.265     0.321

        46     0.047     0.109     0.156     0.218     0.266     0.319

        48     0.047     0.125     0.172     0.217     0.281     0.319

        50     0.047      0.11     0.172     0.219     0.266     0.329

        52     0.062     0.125     0.172     0.234     0.281     0.343

        54     0.047     0.125     0.187     0.234     0.297     0.344

        56     0.063     0.109     0.188     0.235     0.281     0.345

        58     0.046     0.141     0.187     0.234     0.309     0.361

        60     0.063     0.125     0.188      0.25     0.292     0.365

        62     0.047     0.125     0.187      0.25     0.312     0.361

        64     0.062      0.14     0.203      0.25     0.313     0.383

        66     0.063     0.125     0.188      0.25     0.312      0.38

        68     0.062     0.141     0.203     0.266     0.329     0.376

        70     0.062     0.141     0.203     0.265     0.328     0.391

        72     0.062      0.14     0.222     0.266     0.328     0.392

        74     0.063     0.141     0.214     0.266     0.344     0.413

        76     0.063     0.156     0.208     0.281     0.342     0.406

        78     0.065     0.141     0.219     0.281     0.344     0.422

        80     0.067     0.156     0.219     0.281     0.344     0.415

        82     0.067     0.156     0.219     0.297     0.359     0.429

        84     0.063     0.157     0.234     0.303     0.359     0.438

        86     0.063     0.156     0.234     0.298     0.375     0.433

        88     0.078     0.156     0.235     0.297     0.383      0.46

        90     0.062     0.172     0.234     0.298     0.381      0.45

        92     0.078     0.156     0.234     0.313     0.375     0.453

        94     0.078     0.172     0.247     0.328      0.39     0.469

        96     0.063     0.172      0.25     0.312     0.406     0.475

        98     0.082     0.172      0.25     0.328     0.391     0.485

       100     0.078     0.177      0.25      0.33     0.406     0.481

       102     0.078     0.179      0.25     0.328     0.407     0.491

       104     0.078     0.181     0.266     0.344     0.421     0.501

       106     0.078     0.183      0.25     0.343     0.426     0.507

       108     0.079     0.172     0.265     0.344     0.422     0.507

       110     0.093     0.188     0.281     0.359     0.437     0.532

       112     0.078     0.203     0.274      0.36     0.448     0.531

       114     0.079     0.187     0.277     0.366     0.437     0.519

       116     0.093     0.188     0.279     0.368     0.453     0.554

       118     0.078     0.203     0.281      0.36     0.453     0.534

       120     0.094     0.203     0.281     0.375     0.462     0.552

       122     0.078     0.203     0.297      0.39     0.469     0.564

       124     0.094     0.203     0.297     0.375     0.468     0.564

       126     0.094     0.204     0.297     0.391     0.469     0.566

       128     0.078     0.218     0.297     0.399     0.485     0.578

       130     0.094     0.203     0.297      0.39     0.484      0.58

       132     0.093     0.219     0.312     0.406     0.484     0.593

       134     0.094     0.219     0.313     0.406     0.512     0.593

       136     0.094     0.219     0.326     0.406     0.498     0.595

       138     0.109     0.218     0.313     0.406     0.515     0.617

       140     0.094     0.219     0.312     0.434       0.5     0.612

       142     0.094     0.235     0.329     0.424     0.531     0.626

       144     0.094     0.218     0.328     0.425     0.516     0.631

       146     0.109     0.235     0.342     0.437     0.531     0.632

       148     0.094     0.234     0.333     0.422     0.547     0.646

       150     0.109     0.242     0.328     0.453     0.531      0.65

       152     0.094     0.224     0.344     0.438     0.565      0.67

       154     0.109      0.25     0.344     0.445     0.549     0.657

       156      0.11     0.235     0.343      0.46     0.562     0.673

       158     0.109      0.25      0.36     0.453     0.578     0.679

       160     0.094     0.234     0.359     0.469     0.577     0.686

       162     0.109      0.25     0.359     0.473     0.583     0.705

       164     0.109      0.25      0.36     0.466     0.591       0.7

       166      0.11      0.25     0.375     0.484     0.591     0.706

       168     0.109     0.258     0.359     0.469       0.6     0.716

       170     0.125     0.263     0.375     0.484     0.602     0.726

       172      0.11      0.25     0.375     0.484      0.61     0.725

       174     0.109     0.266     0.391       0.5     0.617      0.72

       176     0.125      0.25     0.382       0.5     0.619     0.725

       178     0.109     0.265     0.375       0.5     0.625     0.742

       180     0.125     0.266      0.39       0.5     0.625     0.738

       182     0.124     0.266     0.407     0.523      0.64     0.757

       184     0.122     0.281      0.39     0.502     0.676      0.75

       186     0.122     0.266     0.407     0.532     0.657     0.761

       188     0.112     0.285     0.406     0.515     0.655     0.768

       190     0.125     0.278     0.406     0.532     0.665     0.766

       192     0.125     0.281     0.406     0.531     0.713     0.772

       194     0.125     0.281     0.407     0.531     0.706     0.789

       196     0.125     0.282     0.421     0.547     0.696     0.789

       198     0.125     0.281     0.434     0.547     0.696     0.798

       200      0.14     0.297     0.428     0.547     0.694     0.813

       202     0.125     0.297     0.429     0.566     0.711     0.805

       204     0.125     0.297     0.422     0.554     0.782     0.833

       206     0.125     0.296     0.437     0.563     0.695     0.822

       208     0.141     0.297     0.438     0.562     0.731     0.845

       210     0.125     0.312     0.437     0.573     0.719     0.842

       212      0.14     0.297     0.453     0.578     0.779     0.859

       214     0.126     0.312     0.438     0.594     0.786     0.874

       216      0.14     0.313     0.469     0.578      0.78     0.865

       218     0.141     0.312     0.453     0.594     0.798     0.875

       220     0.125     0.313     0.468     0.613     0.762     0.883

       222      0.14     0.332     0.467      0.61     0.794     0.888

       224     0.141     0.311      0.47     0.609     0.766     0.893

       226     0.141     0.328     0.468     0.623     0.775     0.897

       228      0.14     0.328     0.469     0.616     0.765     0.913

       230     0.157     0.328     0.469     0.625     0.773     0.922

       232      0.14     0.328     0.484     0.641     0.773     0.921

       234     0.141     0.328     0.485      0.64     0.775     0.931

       236     0.156     0.344     0.484     0.638     0.782     0.943

       238     0.141     0.344     0.484     0.641     0.798     0.953

       240     0.156     0.344       0.5     0.641     0.794     0.952

       242     0.141     0.343     0.508     0.656     0.811     0.955

       244     0.156     0.344     0.503     0.663     0.804     0.975

       246      0.14     0.344       0.5     0.657     0.819     0.972

       248     0.157     0.359     0.515     0.656     0.808     0.971

       250     0.156     0.344     0.516     0.683     0.837     0.992

       252     0.156     0.368     0.502     0.671      0.83     0.992

       254     0.173     0.351     0.532     0.672     0.842     0.993

       256     0.161      0.36     0.515     0.688     0.855     1.003

       258     0.161     0.359     0.532     0.672     0.849     1.001

       260     0.151     0.375      0.53     0.703     0.866     1.029

       262     0.172     0.375     0.543     0.692     0.859     1.024

       264     0.156     0.375      0.53     0.688     0.882     1.033

       266     0.156     0.375     0.545     0.719     0.878      1.04

       268     0.172     0.375     0.547     0.703     0.875      1.04

       270     0.172     0.377     0.563     0.718     0.885     1.055

       272     0.156     0.391     0.547     0.719     0.895     1.047

       274     0.172     0.375     0.554     0.735     0.897     1.067

       276     0.172     0.391     0.563     0.718     0.913     1.069

       278     0.172     0.396     0.562     0.735     0.898      1.08

       280     0.172     0.391     0.573     0.748     0.928     1.094

       282     0.172     0.391     0.555     0.734     0.915     1.099

       284     0.172      0.39     0.578      0.75     0.924     1.088

       286     0.187     0.391     0.578      0.75      0.92       1.1

       288     0.172     0.406     0.578     0.766     0.946     1.103

       290     0.172     0.407     0.578      0.75     0.927     1.107

       292     0.187     0.406     0.594     0.777     0.955     1.117

       294     0.172     0.406     0.578     0.757     0.943     1.127

       296     0.188     0.406     0.594     0.781     0.953     1.124

       298     0.172     0.406     0.597     0.766     0.949     1.125

       300     0.187     0.407     0.594     0.781     0.961     1.139

Press any key to continue . . .

--------------------------------------------------------------------------------

The ideal recursion limit seemed to be between roughly 6 and 26. 
For the most part, time increased as the recursion limit increased, 
with the exception of small values such as 2 and 4 that took a little 
longer than the limits slightly larger than them. As such, the best 
recursion limits were generally above 6 but no greater than 26, as 
the times stopped being mostly flat and skyrocketed after this point.
*/